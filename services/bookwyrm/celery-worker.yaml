apiVersion: apps/v1
kind: Deployment
metadata:
  name: celery-worker 
  labels:
    app: celery-worker
spec:
  replicas: 1
  selector:
    matchLabels:
      app: celery-worker
  template:
    metadata:
      labels:
        app: celery-worker
        app.kubernetes.io/name: bookwyrm-celery-worker
    spec:
      containers:
      - name: celery-worker
        image: cmoultrie/bookwyrm@sha256:1790976da5c6bdbc5940ab65b5d8923dd67d81ce1d9fc441e777cbbdd4346eeb
        command: ["/usr/local/bin/celery"]
        args: ["-A", "celerywyrm", "worker", "-l", "info", "-Q", "high_priority,medium_priority,low_priority,imports"]
        volumeMounts:
        - name: bookwyrm-env
          mountPath: "/app/.env"
          subPath: ".env"
          readOnly: true
      volumes:
      - name: bookwyrm-env
        secret:
          secretName: bookwyrm-env
